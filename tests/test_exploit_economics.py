from exploit_economics import EconomicInput, LiquiditySource, assess_exploit_economics, estimate_gas_cost_usd


def test_estimate_gas_cost_usd():
    cost = estimate_gas_cost_usd(estimated_gas_units=500000, gas_price_gwei=20.0, eth_price_usd=3000.0)
    assert cost > 0
    assert round(cost, 2) == 30.0


def test_assess_exploit_economics_viable():
    assessment = assess_exploit_economics(
        EconomicInput(
            estimated_stolen_value_usd=500000.0,
            required_capital_usd=100000.0,
            estimated_gas_units=700000,
            gas_price_gwei=25.0,
            eth_price_usd=3000.0,
            liquidity_sources=[
                LiquiditySource(source="Balancer", available_usd=150000.0),
                LiquiditySource(source="Aave", available_usd=200000.0),
            ],
        )
    )
    assert assessment.flash_loan_available
    assert assessment.profitable
    assert assessment.viable


def test_assess_exploit_economics_not_viable_due_to_liquidity():
    assessment = assess_exploit_economics(
        EconomicInput(
            estimated_stolen_value_usd=50000.0,
            required_capital_usd=200000.0,
            estimated_gas_units=500000,
            gas_price_gwei=40.0,
            eth_price_usd=3000.0,
            liquidity_sources=[LiquiditySource(source="Aave", available_usd=10000.0)],
        )
    )
    assert not assessment.flash_loan_available
    assert not assessment.viable